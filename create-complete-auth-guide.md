# üîê –ü–û–õ–ù–û–ï –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –í–ù–ï–î–†–ï–ù–ò–Æ –°–ò–°–¢–ï–ú–´ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò

## **‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û**

### **1. –°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã:**
- ‚úÖ `create-auth-system.sql` - SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∏ —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ `lib/stores/authStore.ts` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å Supabase
- ‚úÖ `src/components/auth/AuthButton.tsx` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π
- ‚úÖ `src/components/auth/AuthProvider.tsx` - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ `test-auth-system.js` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `ClientLayoutWrapper.tsx` —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π AuthProvider

### **2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ **–†–µ–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Supabase** –≤–º–µ—Å—Ç–æ demo-—Ä–µ–∂–∏–º–∞
- ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º  
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π** (admin, user, premium) —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- ‚úÖ **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - Row Level Security –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è** –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

---

## **üöÄ –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ó–ê–ü–£–°–ö–£**

### **–®–ê–ì 1: –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª** 
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø–∞–ø–∫–∏ `arcanum-platform/` —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```env
# Supabase Configuration (Client-side)
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key-here

# Supabase Configuration (Server-side) 
SUPABASE_SERVICE_KEY=your-supabase-service-role-key-here
SUPABASE_URL=https://your-project-id.supabase.co

# OpenAI Configuration
OPENAI_API_KEY=your-openai-api-key-here

NODE_ENV=development
```

### **–®–ê–ì 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç**
1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard**: https://supabase.com/dashboard/project/YOUR_PROJECT_ID
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞ `create-auth-system.sql`
4. –ù–∞–∂–º–∏—Ç–µ **Run** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### **–®–ê–ì 3: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
```powershell
cd arcanum-platform
npm install @supabase/supabase-js @supabase/ssr
```

### **–®–ê–ì 4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É** 
```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
npm install @supabase/supabase-js --save-dev

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .env)
node test-auth-system.js
```

### **–®–ê–ì 5: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
```powershell
npm run dev
```

### **–®–ê–ì 6: –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω—Å–∫–∏–π –∞–∫–∫–∞—É–Ω—Ç**
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
2. –ù–∞–∂–º–∏—Ç–µ **"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"** 
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —Å –≤–∞—à–∏–º email
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É)
5. –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
SELECT set_admin_role('your-admin-email@example.com');
```

---

## **üéØ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –°–ò–°–¢–ï–ú–£ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò**

### **–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö React:**

```typescript
import { useAuth, useRole } from '@/lib/stores/authStore'

function MyComponent() {
  const { user, isAuthenticated, login, logout } = useAuth()
  const { hasRole, isAdmin } = useRole()
  
  if (!isAuthenticated) {
    return <div>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</div>
  }
  
  return (
    <div>
      <h1>–ü—Ä–∏–≤–µ—Ç, {user?.name}!</h1>
      
      {/* –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ */}
      {isAdmin() && (
        <AdminPanel />
      )}
      
      {/* –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è Premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */}
      {hasRole('premium') && (
        <PremiumFeatures />
      )}
      
      <button onClick={logout}>–í—ã–π—Ç–∏</button>
    </div>
  )
}
```

### **API Routes —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π:**

```typescript
// app/api/admin/route.ts
import { createClient } from '@/lib/supabase/client'

export async function GET() {
  const supabase = createClient()
  
  const { data: { session } } = await supabase.auth.getSession()
  
  if (!session) {
    return Response.json({ error: 'Unauthorized' }, { status: 401 })
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const { data: hasAccess } = await supabase
    .rpc('check_user_role', { 
      user_uuid: session.user.id, 
      required_role: 'admin' 
    })
  
  if (!hasAccess) {
    return Response.json({ error: 'Forbidden' }, { status: 403 })
  }
  
  // –õ–æ–≥–∏–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
  return Response.json({ message: 'Admin content' })
}
```

---

## **üîß –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´**

### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ SQL:**

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT u.email, ur.role, ur.created_at 
FROM auth.users u 
LEFT JOIN user_roles ur ON u.id = ur.user_id;

-- –°–¥–µ–ª–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–¥–º–∏–Ω–æ–º
SELECT set_admin_role('email@example.com');

-- –ò–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
UPDATE user_roles 
SET role = 'premium' 
WHERE user_id = (SELECT id FROM auth.users WHERE email = 'email@example.com');

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–æ–ª—å
SELECT check_user_role(
  (SELECT id FROM auth.users WHERE email = 'email@example.com'), 
  'admin'
);
```

### **–û—Ç–ª–∞–¥–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
console.log('–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', useAuthStore.getState().user)
console.log('–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', useAuthStore.getState().isAuthenticated)

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥
useAuthStore.getState().logout()

// Demo –≤—Ö–æ–¥
useAuthStore.getState().login('demo@arcanum.dev', 'demo')
```

---

## **üõ°Ô∏è –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨**

### **–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ **Row Level Security (RLS)** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞** - –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ —Ä–æ–ª—è–º–∏
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ**
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã** —Å SECURITY DEFINER
- ‚úÖ **–ó–∞—â–∏—Ç–∞ API endpoints** —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–µ—Å—Å–∏–∏

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- üîê –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env —Ñ–∞–π–ª—ã –≤ Git
- üîê –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ API –∫–ª—é—á–∏
- üîê –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- üîê –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

---

## **üéä –†–ï–ó–£–õ–¨–¢–ê–¢**

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

### **üîê –î–õ–Ø –û–ë–´–ß–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô:**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- –í—Ö–æ–¥/–≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

### **üëë –î–õ–Ø –ê–î–ú–ò–ù–ê:**
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ UI —ç–ª–µ–º–µ–Ω—Ç—ã (–∑–Ω–∞—á–æ–∫ ADMIN)
- –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω—Å–∫–∏–º API endpoints

### **üíª –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê:**
- –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- Demo-—Ä–µ–∂–∏–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è  
- –£–¥–æ–±–Ω—ã–µ —Ö—É–∫–∏ –¥–ª—è React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## **‚ùì –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú**

### **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase:**
```
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π –≤ .env —Ñ–∞–π–ª–µ
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–æ–µ–∫—Ç –∞–∫—Ç–∏–≤–µ–Ω –≤ Supabase Dashboard
```

### **RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø:**
```sql
-- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
ALTER TABLE user_roles DISABLE ROW LEVEL SECURITY;
-- –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ!
ALTER TABLE user_roles ENABLE ROW LEVEL SECURITY;
```

### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–ª—Å—è –ª–∏ –ø—Ä–æ—Ñ–∏–ª—å
SELECT * FROM user_roles WHERE user_id = (SELECT id FROM auth.users WHERE email = 'email@example.com');

-- –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤—Ä—É—á–Ω—É—é
INSERT INTO user_roles (user_id, role) 
VALUES ((SELECT id FROM auth.users WHERE email = 'email@example.com'), 'user');
```

---

**üöÄ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!** 

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è, –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å —Ä–æ–ª—è–º–∏, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ Arcanum Platform. 