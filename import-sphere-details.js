const { createClient } = require('@supabase/supabase-js')
require('dotenv').config()

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://ixerlqcqwpevjpycwkwv.supabase.co'
const supabaseServiceKey = process.env.SUPABASE_SERVICE_KEY

if (!supabaseServiceKey) {
  console.error('❌ SUPABASE_SERVICE_KEY не найден в .env файле!')
  process.exit(1)
}

const supabase = createClient(supabaseUrl, supabaseServiceKey)

// Полная детализация сфер из WholeMyMemory.md
const sphereDetails = {
  'S1': {
    "meta": {
      "title": "S1 — Vitality (Тело/Реактор)",
      "matrix_position": "Ядро × Энергия",
      "mission": "Производить устойчивую физическую мощность для всех остальных сфер."
    },
    "components": {
      "sleep": {
        "status": "Критическая уязвимость, самое слабое звено.",
        "issues": [
          "Системный энергетический дефолт из-за провалов в восстановлении.",
          "Нарушение протоколов сна из-за работы до поздней ночи или 'скуки'.",
          "Низкое качество сна из-за внешних факторов (свет из окна).",
          "Гиперактивность мозга после дофаминовых всплесков мешает засыпанию."
        ],
        "protocols": [
          "Принудительный отбой (комендантский час) в 22:00-23:00.",
          "Фаза 'аналогового замещения' (книги, музыка) за час до сна, экраны запрещены.",
          "Использование снотворных таблеток для принудительной перекалибровки.",
          "Протокол «Ванна+фильм» для расслабления."
        ]
      },
      "nutrition": {
        "status": "Нестабильно, зависит от финансового состояния.",
        "core_principle": "Приоритет полноценного перекуса (особенно белкового) над стимуляторами (кофе).",
        "goals": "120-150 г белка в день.",
        "boosters": [
          {
            "name": "Селёдка",
            "effect": "Резкий подъем энергии."
          },
          {
            "name": "Киви + сырые яйца",
            "effect": "Взрыв энергии."
          }
        ],
        "poisons": [
          {
            "name": "Алкоголь (особенно пиво)",
            "effect": "Гасит энергию на следующий день, активирует дебафф 'Самоненависть'."
          },
          {
            "name": "Жирная еда без цели",
            "effect": "Сонливость, 'тупняк'."
          },
          {
            "name": "Еда без белка",
            "effect": "Депрессия, слабость."
          }
        ],
        "supplements_stack": {
          "status": "Активно используется, но требует систематизации.",
          "components": [
            "Андро-поддержка (Форсколин, Тонгкат Али)",
            "Нейро-фокус (L-Теанин, ALCAR, DMAE, Lion's Mane)",
            "Настрой (Экстракт шафрана)",
            "Общий тонус (Витамины B-комплекс)",
            "Восстановление (Магний треонат, CoQ10, Креатин, Глютамин)",
            "Замена кофеина (Боярышник)"
          ]
        }
      },
      "training": {
        "status": "Энтропия активна при бездействии.",
        "components": [
          "Силовые (гантели, бокс, муай-тай)",
          "Кардио ('Кислородный Форсаж', велосипед, бой с тенью)",
          "Протокол «Ледяное Сердце» (холодные ванны, река/озеро)"
        ],
        "protocols": {
          "oxygen_boost_ritual": {
            "name": "Ритуал Кислородного Форсажа",
            "activation": "Поездка на велосипеде/скейтборде > 30 минут.",
            "effect": "+25 к ЭНЕРГИИ на 4 часа, снимает дебаффы 'Сонливость' и 'Тупняк'."
          },
          "ice_heart_protocol": {
            "name": "Протокол «Ледяное Сердце»",
            "activation": "Ледяная ванна или погружение в естественный водоем.",
            "goal": "Перезагрузка нервной системы, сбор данных о реакции организма, создание контента."
          }
        }
      },
      "physical_symptoms": {
        "migraines": {
          "status": "Периодические, сильные.",
          "triggers": "Резкая смена атмосферного давления, высокая влажность, падение серотонина, дегидратация, избыток кофеина, когнитивная перегрузка.",
          "protocol": "Регулярное кардио (ключевая защита), CoQ10, контрастный душ, массаж головы."
        },
        "other": [
          "Судороги пальцев ног (дефицит минералов/электролитов).",
          "Боль в руках от перенагрузки гантелями."
        ]
      }
    },
    "synergy": {
      "produces_for": {
        "S2_MIND_CODE": "Повышает внимание и скорость обучения.",
        "S6_CRAFT_PRODUCTION": "Даёт длинные отрезки Deep Work без свала.",
        "S7_STATUS_DISCIPLINE": "Дисциплина через тренировочные «микро-бои».",
        "S5_COMMUNICATION_INFLUENCE": "«Энергетичный» образ усиливает бренд."
      },
      "consumes_from": {
        "S3_HABITAT": "Сцены сна/рабочего места/зала.",
        "S2_MIND_CODE": "Техника движений, метрики.",
        "S9_CAPITAL_RESOURCES": "Оборудование, мониторинг, БАДы, качественная еда."
      }
    }
  },
  
  'S2': {
    "meta": {
      "title": "S2 — Mind/Code (Разум/Код)",
      "matrix_position": "Ядро × Информация",
      "mission": "Держать чистый «корневой код»: ценности, убеждения, фокус, метанавыки (внимание, память, обучение, языки)."
    },
    "components": {
      "cognitive_models_and_doctrines": {
        "core_nature": "Виртуоз-импровизатор, чья сила и слабость — в хаосе. Динамически адаптирует любой план в процессе выполнения.",
        "primary_doctrine": {
          "name": "Доктрина Дофаминового Доминирования",
          "description": "Осознанное перенаправление врожденной дофаминовой зависимости с деструктивных привычек (бессонные ночи, рискованные практики) на конструктивные (бизнес, контент, тело, система «Арканум»).",
          "status": "Принята как Великая Стратегия."
        },
        "secondary_doctrines": [
          {
            "name": "Протокол «Черное Солнце»",
            "description": "Использовать неудачи и проблемы членов семьи как топливо для двукратного усиления концентрации на собственных целях."
          },
          {
            "name": "Доктрина Самоверификации",
            "description": "Единственным источником валидации, похвалы и поддержки является сам Оператор, что исключает зависимость от внешней оценки."
          }
        ],
        "decision_making_protocols": [
          {
            "name": "Фильтр-Преторианец",
            "description": "Система из трех вопросов (Ответственность, Намерение, ROI) для отсечения импульсивного желания помочь другим и предотвращения утечки ресурсов."
          },
          {
            "name": "Протокол «Холодный Штурвал»",
            "description": "Тактика непрямого асимметричного ответа в партнерстве: сокращение собственного вклада, передача инициативы и маскировка перераспределения ресурсов на личные проекты."
          }
        ],
        "self_regulation_models": [
          {
            "name": "Дирижёр",
            "description": "Рассматривать эмоции и состояния (усталость, злость, вдохновение) как управляемый оркестр, а не хаотичную силу."
          },
          {
            "name": "Протокол «Внутренний Трибунал»",
            "description": "Ежедневный ритуал перед зеркалом для аудита дня, включающий вербальную похвалу за победы и коррекцию провалов."
          }
        ]
      },
      "psychological_state": {
        "primary_driver": "Ауто-возбуждение — получение энергии и мотивации от образа идеальной, более сильной версии себя.",
        "root_weakness": "«Демон Сочувствия» / «Слабый фильтр» — когнитивная ошибка, заставляющая тратить ресурсы на нерелевантные внешние цели (спасение других).",
        "core_trauma_loop": "«Спасатель-Мученик» — бессознательное воспроизведение детской травмы в партнерствах, где Оператор играет роль перерабатывающей 'матери', а партнер — роль 'отца-потребителя'.",
        "triggers": [
          "Контроль, поучение, нарциссизм от некомпетентных людей.",
          "Доминантное поведение и 'демонический' голос младшего брата, активирующий программу 'Жертва'.",
          "Образ 'больной, уставшей' матери, активирующий вирус 'Жалость' и приводящий к срывам."
        ]
      },
      "technical_skills_and_projects": {
        "active_development_skills": [
          "AI Image Generation (SORA, Midjourney).",
          "Промпт-инжиниринг (разработка системы промптов для Маскота и комикса).",
          "Деплоймент (Vercel)."
        ],
        "backlog_skills": [
          "Docker, Git.",
          "LLM-интеграция, AI-агенты (Python)."
        ],
        "key_projects": [
          {
            "name": "Арканум-Интерфейс (Life-management dashboard)",
            "status": "Приоритетный, в фазе проектирования. Заморожен до закрытия административных долгов."
          },
          {
            "name": "AI-комикс ('Нуар-Терапия' / 'Одинотарис')",
            "status": "Приоритет для быстрой монетизации. Создаются ассеты (монстры, маскот)."
          },
          {
            "name": "Интерактивная книга (проект 'АБ' с Борисом)",
            "status": "Переведен в режим низкой интенсивности. Используется как источник лора."
          },
          {
            "name": "ChatBot WCAG (для Алексея)",
            "status": "Технически готов к деплою. Используется как рычаг в переговорах для получения документа о практике."
          }
        ]
      }
    },
    "synergy": {
      "produces_for": {
        "S6_CRAFT_PRODUCTION": "Ускоряет освоение инструментов и технологий, что повышает скорость и качество производства.",
        "S5_COMMUNICATION_INFLUENCE": "Ясные мысли и структурированные доктрины формируют сильный, убедительный бренд и коммуникацию.",
        "S7_STATUS_DISCIPLINE": "Когнитивные стратегии и переоценка триггеров повышают стрессоустойчивость и ментальную броню."
      },
      "consumes_from": {
        "S1_VITALITY_REACTOR": "Требует стабильного потока физической энергии для поддержания фокуса и нейропластичности.",
        "S8_NETWORK_LIBRARY": "Использует внешние знания и смыслы для отбора и приоритизации собственных идей и направлений обучения."
      }
    }
  },

  'S3': {
    "meta": {
      "title": "S3 — Habitat (Среда/Кокон)",
      "matrix_position": "Ядро × Материя",
      "mission": "Создавать сцены потока и минимизировать «грязное трение» (логистика, свет/звук, интерфейсы, гардероб, быт)."
    },
    "components": {
      "physical_environment": {
        "long_term_goal": "Переезд в локацию с горами и 'грозами 300 дней в году', чтобы соответствовать внутреннему состоянию.",
        "current_vulnerability": "Серость швейцарских дней, особенно осенью-зимой, которая гасит внутренний огонь, провоцирует дебафф «Ноябрьское Увядание» и напрямую снижает уровень энергии.",
        "key_resources": [
          {
            "name": "Природа",
            "details": "Лес (der Wald), гора (der Berg), ветер (der Wind) являются не отдыхом, а ритуалом подзарядки внутреннего реактора."
          },
          {
            "name": "Водоем",
            "details": "Обнаружена река/озеро ('вальги') возле дома как новый, более эффективный ресурс для проведения протокола «Ледяное Сердце»."
          }
        ],
        "workspace_and_scenes": {
          "goal": "Организация рабочего пространства и 'съемочных' спотов для быстрого создания контента.",
          "tools": [
            {
              "name": "Инфракрасная лампа",
              "purpose": "Личный источник солнца для подавления мелатонина и борьбы с сезонной апатией."
            }
          ]
        }
      },
      "digital_environment_and_tools": {
        "ai_and_generative_stack": {
          "llms": "ChatGPT, Gemini (предпочтителен за большой контекст), Claude (возможен).",
          "image_video": "Sora/Veo3, Midjourney/Stable Diffusion."
        },
        "development_and_productivity_stack": {
          "tools": "GitHub, OBS, Canva, Google Sheets, Docker, Cursor."
        },
        "custom_tools_and_assets": [
          "Платформа для интерактивных сценариев.",
          "Инструмент «Advanced Replacer for Google Docs».",
          "AI-агенты для ARIA/WCAG и readability.",
          "Система промптов для генерации маскота в разных состояниях."
        ],
        "blockers_and_limitations": [
          "Психологический блок на платформу Upwork.",
          "Технические проблемы с Docker на 'взломанной Windows'.",
          "Сломанный ноутбук, мешающий посещать нетворкинг-ивенты."
        ]
      },
      "lifestyle_and_constraints": {
        "legal_status": "Статус S в Швейцарии, получение социальной помощи.",
        "work_philosophy": "Стремление к 4 часам глубокой, сфокусированной работы в день, отсекая рутину и бессмысленные задачи ('херню').",
        "core_desire": "Достижение полной свободы и независимости."
      }
    },
    "synergy": {
      "produces_for": {
        "S1_VITALITY_REACTOR": "Оптимизированная среда (кухня, спальня, место для тренировок) уменьшает трение для выполнения ритуалов.",
        "S6_CRAFT_PRODUCTION": "Готовые 'сцены' и настроенный цифровой инструментарий обеспечивают быстрый старт и непрерывность производственных сессий.",
        "S5_COMMUNICATION_INFLUENCE": "Подготовленные 'съемочные' споты и шаблоны в цифровых инструментах ускоряют создание контента."
      },
      "consumes_from": {
        "S9_CAPITAL_RESOURCES": "Требует бюджета на покупку и апгрейд оборудования (лампа, компьютер) и программного обеспечения.",
        "S7_STATUS_DISCIPLINE": "Необходима дисциплина для поддержания порядка в физическом и цифровом пространстве (еженедельный declutter)."
      }
    }
  },

  'S4': {
    "meta": {
      "title": "S4 — Action/Vector (Действие/Вектор)",
      "matrix_position": "Процесс × Энергия",
      "mission": "Конвертировать волю в движение — тренировки, «неприятное первым», короткие штурмы, рутинные рычаги."
    },
    "components": {
      "action_initiation_protocols": {
        "pre_session_ritual": {
          "name": "Ритуал Разгона",
          "description": "Применяется для резкого подъема энергии перед началом работы, особенно при ее дефиците.",
          "components": [
            "Прием расходника «Селёдка» или «Киви+Яйца».",
            "Применение «Холодного душа» или контрастной воды."
          ],
          "effect": "+30 к ЭНЕРГИИ на 2 часа, снимает дебафф «Сонливость»."
        },
        "mental_kickstart": {
          "name": "Голос Генерала",
          "activation": "Активация внутреннего счёта до 500 и аффирмаций («я побеждаю, доминирую»).",
          "effect": "Дает временный иммунитет к дебаффу «Прокрастинация»."
        },
        "focus_block_methodology": {
          "preference": "Предпочитает длительные, непрерывные погружения. Требуется около часа на полный вход в состояние фокуса.",
          "ineffective_methods": "Метод 'Помидора' (25 мин) неэффективен и не используется."
        }
      },
      "execution_style_and_patterns": {
        "core_conflict": "Миниган vs. Снайпер. Постоянная борьба между врожденной многопоточностью (ADHD), охватывающей всё, и необходимостью снайперского фокуса на задачах, дающих 80% результата.",
        "dominant_pattern": "Виртуоз-импровизатор. Динамически адаптирует любой план в процессе выполнения, что является одновременно силой (гибкость) и слабостью (потеря ритма, расфокус).",
        "sabotage_patterns": [
          {
            "name": "LEGO_SIDETRACK",
            "description": "Появление новой 'гениальной' идеи используется как повод для уклонения от выполнения текущей, рутинной или сложной задачи."
          },
          {
            "name": "PERFECTIONISM_SABOTAGE",
            "description": "Проявляется в усложнении задачи (например, добавление слабых/сильных сторон монстра) вместо выполнения основной цели (подготовить 40 постов)."
          },
          {
            "name": "Трудоголизм как Поиск Одобрения",
            "description": "Приобретенный в детстве паттерн для получения похвалы (особенно от отца) и решения проблем семьи."
          }
        ]
      },
      "operational_modes": {
        "analytical_mode": {
          "name": "Протокол «L-РЕЖИМ»",
          "activation": "Музыка 'L's Theme (Death Note)'.",
          "state": "Состояние холодной, прагматичной, стратегической точности."
        },
        "high_pressure_mode": {
          "name": "Режим «Хищник»",
          "activation": "Включается под давлением или при ощущении несправедливости.",
          "mechanics": "Агрессия используется как топливо, но требует дисциплины для предотвращения срыва в хаос."
        }
      },
      "action_governance_doctrines": {
        "primary_directive": {
          "name": "Принцип Снайпера (Директива №4)",
          "description": "Фокус на цели, дающей 80% результата. Постоянный поиск и уничтожение задач-паразитов, отнимающих энергию без ощутимого продвижения к главным целям (деньги, проекты, форма)."
        },
        "dopamine_doctrine": {
          "name": "Доктрина Дофаминового Доминирования",
          "description": "Перенаправление врожденной дофаминовой зависимости на конструктивные действия, превращая собственное развитие в главный 'наркотик'.",
          "allowed_actions_for_reward": [
            "Получение XP в системе 'Арканум'",
            "Завершение кардио-тренировки > 45 мин",
            "Сеанс в ледяной ванне",
            "Публикация единицы контента (видео, пост)",
            "Получение оплаты за работу",
            "Закрытие административного 'хвоста'."
          ],
          "forbidden_actions": [
            "Бесцельный скроллинг соцсетей",
            "Изучение новых технологий без немедленного плана монетизации",
            "Споры ради доказывания правоты",
            "Практика 'перезагрузки мозга'",
            "Алкоголь, никотин, порнография."
          ]
        }
      }
    },
    "synergy": {
      "produces_for": {
        "S6_CRAFT_PRODUCTION": "Даёт старт любой производящей сессии, конвертируя волю в материальный результат.",
        "S7_STATUS_DISCIPLINE": "Укрепляет «мышцу» самоконтроля через выполнение запланированных действий и ритуалов.",
        "S5_COMMUNICATION_INFLUENCE": "Регулярность и последовательность действий обеспечивают стабильный контент-ритм и укрепляют бренд."
      },
      "consumes_from": {
        "S1_VITALITY_REACTOR": "Требует физического ресурса (энергии) для выполнения волевых усилий, тренировок и длительных рабочих сессий.",
        "S2_MIND_CODE": "Нуждается в четких микро-планах, целях и когнитивных моделях для предотвращения расфокуса и саботажа."
      }
    }
  },

  'S5': {
    "meta": {
      "title": "S5 — Communication/Influence (Связи/Коммуникация/Влияние)",
      "matrix_position": "Процесс × Информация",
      "mission": "Обмен информацией, репутация, бренд, контент-система, переговоры, продажи, комьюнити."
    },
    "components": {
      "personal_brand_and_style": {
        "communication_style": "Предпочитает сарказм, иронию, «жёсткую правду» и элитный стиль («не пальцем деланный»).",
        "preferred_formats": [
          "Короткие, чёткие фразы в стиле команд на судне («Зафиксировал», «Принял», «Сделано»).",
          "Режим «LSD-вайб» для исследования сложных концепций через образы, метафоры и сенсорику."
        ],
        "communication_triggers_negative": [
          "Сюсюканье, пустые похвалы («ты можешь всё» без конкретики).",
          "Контроль, поучение, нарциссические приёмы от некомпетентных людей.",
          "Роботизированный, безэмоциональный тон."
        ],
        "visual_aesthetics": "Стиль определяется как Нуар, Dark Fantasy, «Джентльмены», кинематографичность 16K SSS."
      },
      "content_strategy": {
        "primary_goal": "Построить СИСТЕМУ ПРОДАЖИ контента, а не просто его производство.",
        "key_projects_and_concepts": [
          {
            "name": "AI-комикс «Нуар-Терапия» / «Дневник Эльмара»",
            "purpose": "Основной быстрый проект для монетизации, используется как «продукт-маяк» для привлечения аудитории."
          },
          {
            "name": "Серия из 60 роликов",
            "concept": "Виральный контент на тему «вылить пиво/кофе -> гантели» для демонстрации трансформации и монетизации."
          },
          {
            "name": "Маскот АБ",
            "description": "Персонаж в стиле «чиби, взрослый», основанный на детских психологических якорях (Arcanum, Fallout), для которого разработана система промптов для генерации в разных состояниях."
          }
        ],
        "platforms": "YouTube Shorts, TikTok, Instagram.",
        "monetization_platforms": "Patreon, Gumroad, Boosty, Kickstarter."
      },
      "network_and_relationship_management": {
        "core_principle": "Фильтрация окружения. Перевод отношений в плоскость «взаимовыгодного партнерства», «использования» или полного отсечения.",
        "identified_hostile_archetypes": [
          {
            "name": "Типаж «Пиявка» (пример: Жека МТВ)",
            "description": "Жалостливый манипулятор, высасывающий ресурс через мелкие просьбы и срыв обещаний."
          },
          {
            "name": "Типаж «Предатель» (пример: Жека Квартал)",
            "description": "Маскируется под друга, но самоутверждается и предает в критический момент."
          }
        ],
        "key_figures_analysis": [
          {
            "name": "Борис",
            "status": "«Нересурсный Актив / Потребитель Энергии». Партнерство признано асимметричным и нежизнеспособным в текущей модели.",
            "strategy": "Протокол «Холодный Штурвал»: сокращение вклада, передача инициативы, маскировка перераспределения энергии на личные проекты."
          },
          {
            "name": "Алексей",
            "status": "Источник потенциального ресурса (документ о практике).",
            "strategy": "Деловой ультиматум: приостановить финальную доработку чат-бота до получения документа."
          },
          {
            "name": "Мать",
            "status": "Источник триггера «Жалость», который активирует вирус «Демон Сочувствия» и приводит к срывам.",
            "strategy": "Протокол «ЩИТ ОТ ЖАЛОСТИ»: физический разрыв, вербальная команда, перенаправление фокуса."
          },
          {
            "name": "Младший брат (Миша)",
            "status": "Классифицирован как «монстр, эгоистичная мразь нарциссическая»; главный антагонист в личной мифологии.",
            "strategy": "Протокол «Черное Солнце»: использовать информацию о его успехах/неудачах как топливо для собственного роста."
          },
          {
            "name": "Дино",
            "status": "Идентифицирован как ключевой социальный актив.",
            "strategy": "Восстановить контакт, используя день рождения как повод."
          }
        ]
      },
      "influence_and_monetization_strategy": {
        "primary_blocker": "Синдром «Вечного Ученика»: страх брать деньги за свои навыки, вызванный страхом неидеальности и получения негативной оценки.",
        "counter_protocol": {
          "name": "Протокол «Сборщик Шрамов»",
          "goal": "Получить не менее 3 отказов в неделю. Каждый отказ расценивается как сбор данных и приносит +25 XP."
        },
        "primary_offer": {
          "product": "«Dark-fantasy AI-комикс-пролог»",
          "specs": "15 кинематографичных кадров, интерактивный PDF с выбором, аудио-саундскейп.",
          "price_point": "3 CHF (используется как лид-магнит).",
          "payment_gateway": "PayPal."
        }
      }
    },
    "synergy": {
      "produces_for": {
        "S9_CAPITAL_RESOURCES": "Монетизация контента и влияние напрямую генерируют доход и финансовые активы.",
        "S3_HABITAT": "Обратная связь от аудитории и партнеров помогает оптимизировать рабочую среду.",
        "S8_NETWORK_LIBRARY": "Активная коммуникация и создание контента расширяют сеть полезных контактов."
      },
      "consumes_from": {
        "S2_MIND_CODE": "Требует ясных мыслей, проработанных идей и скриптов для сильной и убедительной коммуникации.",
        "S7_STATUS_DISCIPLINE": "Статус и репутация, построенные на дисциплине, многократно усиливают влияние и вес слов.",
        "S6_CRAFT_PRODUCTION": "Нуждается в готовых продуктах, артефактах и кейсах, чтобы было что показывать и продавать."
      }
    }
  },

  'S6': {
    "meta": {
      "title": "S6 — Craft/Production (Производство/Крафт)",
      "matrix_position": "Процесс × Материя",
      "mission": "Материализовывать ценность — код, продукт, визуал, документ, бизнес-процесс."
    },
    "components": {
      "core_products_and_artifacts": {
        "digital_products": [
          {
            "name": "AI-комикс «Нуар-Терапия» / «Одинотарис»",
            "description": "Быстрый проект для монетизации, основной творческий актив на данный момент.",
            "status": "В процессе создания ассетов."
          },
          {
            "name": "AI-агенты для WCAG/Readability",
            "description": "Продукт/услуга для продажи. Разработка в бэклоге.",
            "status": "Бэклог."
          },
          {
            "name": "Интерактивная книга «АБ»",
            "description": "Медленный, совместный проект с Борисом. Том 1 завершен.",
            "status": "Низкий приоритет."
          },
          {
            "name": "Life-management dashboard «Арканум-Интерфейс»",
            "description": "Главный мета-проект по систематизации жизни, стилизованный под RPG.",
            "status": "В фазе проектирования, разработка заморожена."
          }
        ],
        "media_content": [
          "Серия из 60 видео-роликов «трансформация».",
          "YouTube Shorts / TikTok клипы для промо.",
          "Telegram-стикеры с кастомным маскотом."
        ]
      },
      "production_pipelines_and_workflows": {
        "code_pipeline": "Cursor (редактирование кода) → GitHub (контроль версий) → Vercel (автоматический деплой).",
        "visual_content_pipeline": "SORA / Midjourney (генерация) → GPT (конвертация в нужный формат, например 512x512 transparent) → Целевая платформа (Instagram, Telegram).",
        "key_optimization": "Прорыв в создании модульных ассетов с прозрачным фоном, что значительно ускоряет конвейер, позволяет комбинировать элементы и устраняет необходимость в Canva."
      },
      "production_blockers_and_vulnerabilities": {
        "psychological_blockers": [
          {
            "name": "Перфекционизм",
            "effect": "Увеличивает время выполнения задач на +50%, проявляется в постоянном усложнении и задержках из-за «идеального портфолио»."
          },
          {
            "name": "Расфокус / Уход в Side-Quests",
            "effect": "Склонность отвлекаться на новые 'гениальные' идеи (например, LEGO-версия мира) вместо завершения текущих задач."
          },
          {
            "name": "Конфликт Статуса",
            "effect": "Внутренний «Технологический Зевс» считает унизительным создавать простые, коммерческие продукты (сайт для стоматолога) и предпочитает создавать сложные, 'элитные' системы бесплатно."
          },
          {
            "name": "Блок на Портфолио",
            "effect": "Психологический блок на создание портфолио и взаимодействие с платформой Upwork."
          }
        ],
        "material_blockers": [
          "Сломанный ноутбук.",
          "Финансовые ограничения для доступа к pro-инструментам и сервисам."
        ]
      },
      "quality_and_aesthetic_standards": {
        "visual_target": "Стремление к стилю Нуар, «Джентльмены», кинематографичности, 16K, SSS и реализму уровня Unreal Engine 5.",
        "process_standard": "Тяга к созданию сложных систем (AI-оркестраторы), что часто конфликтует с необходимостью быстрого выпуска MVP (минимально жизнеспособного продукта)."
      }
    },
    "synergy": {
      "produces_for": {
        "S5_COMMUNICATION_INFLUENCE": "Создает материальные активы (продукты, кейсы, контент), которые можно показывать миру и продавать.",
        "S9_CAPITAL_RESOURCES": "Является основным источником генерации ценности, которая напрямую конвертируется в доход и финансовые активы.",
        "S7_STATUS_DISCIPLINE": "Каждый успешный релиз и завершенный проект укрепляет внутренний статус, самооценку и репутацию."
      },
      "consumes_from": {
        "S1_VITALITY_REACTOR": "Требует высокого и стабильного уровня физической энергии для длительных сессий глубокой работы (Deep Work).",
        "S2_MIND_CODE": "Нуждается в четких навыках, планах и ментальном фокусе для эффективного производства.",
        "S3_HABITAT": "Требует подготовленной 'сцены' — оптимизированного физического и цифрового рабочего пространства для непрерывной работы."
      }
    }
  },

  'S7': {
    "meta": {
      "title": "S7 — Status/Discipline (Статус/Дисциплина)",
      "matrix_position": "Система × Энергия",
      "mission": "Накапливать силу воли и социальный авторитет через выполненные обещания и качество действий."
    },
    "components": {
      "core_discipline_system": {
        "central_tool": "ВИРДЖИЛ v2.0 (Мой-Клон) используется как внешний контур контроля для удержания вектора, отсечения информационного шума и обеспечения принудительной дисциплины.",
        "gamification_engine": {
          "mechanics": "Система начисления/списания XP за выполнение/провал задач, система уровней и квестов для геймификации прогресса.",
          "reward_protocol": {
            "name": "Протокол «Голос Генерала»",
            "description": "Система поощрения, в которой после каждого успешного рапорта проигрывается случайное мотивирующее видео-обращение от Оператора к самому себе."
          },
          "punishment_protocol": {
            "name": "Протокол «Счет Иуды»",
            "description": "Проектируемая автономная система наказания, которая в случае провала дедлайна автоматически списывает деньги с привязанной карты на счет демотивирующего лица (Жека МТВ)."
          }
        },
        "management_tools": [
          "Emo-Checklist: Используется для трекинга состояний по категориям «заряд/рефлексия/контент».",
          "Ежедневный Чек-лист «SHIP IT»: Набор обязательных ежедневных действий для обеспечения базовой продуктивности."
        ]
      },
      "willpower_and_self_control": {
        "self_assessment": "Оператор признает, что самодисциплина является его слабым местом.",
        "key_vulnerability": "Эмоциональные качели и срывы на алкоголь под давлением психологических триггеров (например, образ больной матери).",
        "successful_protocols": [
          {
            "name": "Трансмутация Либидо v1.0",
            "description": "При возникновении сексуального импульса активируется вербализация перед зеркалом для перенаправления энергии на образ «успешной версии себя»."
          },
          {
            "name": "Фильтр-Преторианец",
            "description": "Набор из трех вопросов для отсечения «Ловушки Пассивного Сочувствия» и предотвращения утечки ресурсов."
          }
        ],
        "emergency_protocols": [
          {
            "name": "Стоп-Саботаж",
            "trigger": "Прокрастинация по ключевой задаче > 2 часов или срыв на алкоголь.",
            "action": "Немедленное прерывание диалога и выдача команды на выполнение первого шага основной цели."
          },
          {
            "name": "Красная Зона",
            "trigger": "Сообщения о зашкаливающем стрессе, агрессии или физических симптомах перегрузки.",
            "action": "Команда на паузу, прием воды/электролитов и выполнение дыхательных практик."
          }
        ]
      },
      "status_and_reputation_goals": {
        "ultimate_goal": "Стать «элитной версией себя» — сильным, свободным, независимым.",
        "core_archetype": "«Генерал Внутреннего Войска» как целевой образ, требующий абсолютного контроля и дисциплины.",
        "foundation_of_status": "Статус строится исключительно на выполненных обещаниях, качестве действий и измеримых результатах (деньги, проекты, форма), а не на идеях."
      },
      "key_rituals_and_protocols": [
        "Протокол «Внутренний Трибунал»: Ежедневный аудит побед и провалов перед зеркалом.",
        "Протокол «Ритм и Пауза»: Введение нерушимого «комендантского часа» в 22:00 и обязательной 30-минутной «Стратегической Паузы» для тренировки мозга.",
        "Использование внешней дисциплины: Публичные челленджи, видео-отчеты и ежедневные ролики для создания социальной ответственности."
      ]
    },
    "synergy": {
      "produces_for": {
        "S5_COMMUNICATION_INFLUENCE": "Высокий статус, основанный на дисциплине, многократно усиливает влияние и вес слов.",
        "S6_CRAFT_PRODUCTION": "Дисциплина обеспечивает стабильный и предсказуемый выпуск продуктов и контента.",
        "S1_VITALITY_REACTOR": "Следование режимам и протоколам предотвращает срывы, ведущие к потере энергии (алкоголь, бессонница)."
      },
      "consumes_from": {
        "S2_MIND_CODE": "Требует когнитивных стратегий и протоколов для перекодировки саботажа и управления триггерами.",
        "S8_NETWORK_LIBRARY": "Использует внешнюю этику и примеры из сети для калибровки собственного статуса и поведения."
      }
    }
  },

  'S8': {
    "meta": {
      "title": "S8 — Network/Library (Сеть/Библиотека)",
      "matrix_position": "Система × Информация",
      "mission": "Создавать внешнюю нейросеть (люди, базы знаний, документация, активы контента)."
    },
    "components": {
      "human_network": {
        "key_allies": [
          {
            "name": "Дино",
            "status": "Идентифицирован как ключевой социальный актив и потенциальный источник поддержки.",
            "action_item": "Восстановить контакт, который не поддерживался в течение месяца."
          }
        ],
        "liabilities_and_energy_drains": [
          {
            "name": "Семья (Мать, Отец, Младший брат)",
            "status": "Классифицированы как «черная дыра энергии» и «проклятие». Являются источниками деструктивных психологических триггеров (Жалость, Гнев)."
          },
          {
            "name": "Борис",
            "status": "Переклассифицирован из «Партнера» в «Нересурсный Актив / Потребитель Энергии» из-за асимметрии рисков и вклада в проект."
          }
        ],
        "strategic_contacts": [
          {
            "name": "Алексей",
            "status": "Источник потенциального ресурса (документ о практике). Взаимодействие строится на принципе «делового ультиматума», а не помощи."
          }
        ],
        "archived_or_hostile_contacts": [
          "Вася (бывший друг, манипулятор)",
          "Жека МТВ (архетип «Пиявка»)",
          "Жека Квартал (архетип «Предатель»)"
        ]
      },
      "knowledge_base_and_skills_library": {
        "technical_knowledge_base": "Активно пополняется знаниями в областях: AI Image/Video Generation (Sora, Veo3, Midjourney), LLM-интеграция, Промпт-инжиниринг, Деплоймент (Vercel).",
        "backlog_knowledge": [
          "Docker",
          "Git"
        ],
        "conceptual_library_project": "Идея создания «библиотеки знаний» (русский, украинский, английский, немецкий) зафиксирована в бэклоге как side-quest."
      },
      "content_asset_library": {
        "mascot_ab_system": {
          "description": "Масштабируемая система для генерации маскота, включающая «Карту Состояний» с 10-15 ключевыми эмоциями и действиями, и готовые промпты для каждого.",
          "status": "Актив создан."
        },
        "ai_comics_assets": {
          "description": "Библиотека сгенерированных ассетов (персонажи, локации) в едином стиле «Нуар / Dark Fantasy» для проекта «Одинотарис».",
          "status": "В процессе накопления."
        },
        "video_archive": {
          "description": "Архив видео-роликов на тему «трансформация» (отказ от пива/кофе) и личных видео-манифестов для протокола «Голос Генерала».",
          "status": "В процессе накопления."
        }
      },
      "core_insights_and_mental_models_library": {
        "psychological_models": [
          "Демон Сочувствия: Главный внутренний враг, заставляющий тратить ресурсы на спасение других.",
          "Травматический цикл «Спасатель-Мученик»: Бессознательное копирование деструктивной семейной динамики в партнерствах.",
          "Доктрина Дофаминового Доминирования: Стратегия перенаправления зависимости на конструктивные цели.",
          "Дирижёр: Модель управления внутренними состояниями как оркестром."
        ],
        "decision_making_frameworks": [
          "Фильтр-Преторианец: Набор из трех вопросов для отсечения нерелевантных задач и просьб.",
          "Принцип Снайпера: Фокус на действиях, дающих 80% результата.",
          "Протокол «Холодный Штурвал»: Стратегия асимметричного ответа в невыгодном партнерстве."
        ]
      }
    },
    "synergy": {
      "produces_for": {
        "S6_CRAFT_PRODUCTION": "Ускоряет производство через повторное использование (reuse) шаблонов, кода, промптов и контент-ассетов из библиотеки.",
        "S5_COMMUNICATION_INFLUENCE": "Предоставляет готовые кейсы, инсайты и архетипы из библиотеки для создания убедительного сторителлинга и контента.",
        "S9_CAPITAL_RESOURCES": "Сеть контактов открывает доступ к новым возможностям, сделкам и информации, которые могут быть монетизированы."
      },
      "consumes_from": {
        "S5_COMMUNICATION_INFLUENCE": "Активная коммуникация и нетворкинг являются основной воронкой для пополнения сети новыми полезными контактами.",
        "S3_HABITAT": "Требует надежных цифровых инструментов (облако, каталогизаторы) для хранения и управления базами знаний и ассетами."
      }
    }
  },

  'S9': {
    "meta": {
      "title": "S9 — Capital/Resources (Ресурсы/Капитал)",
      "matrix_position": "Система × Материя",
      "mission": "Деньги, инструменты, инфраструктура; финансовые буферы и инвестиции."
    },
    "components": {
      "financial_goals_and_deadlines": {
        "primary_goal": "$2000/мес пассивного дохода к ~24.01.2026. Абсолютный приоритет ААА+.",
        "intermediate_milestone": "$500/мес пассивного дохода к 31.10.2025.",
        "benchmark_goal": "4000 CHF/мес, работая на себя по 5-6 часов в день, что является метрикой перехода на новый уровень ('Архитектор').",
        "aspirational_goal": "$10,000/мес стабильно, отсутствие которого воспринимается как следствие неверных ментальных 'настроек'."
      },
      "current_financial_status": {
        "assessment": "КРИТИЧЕСКИЙ. Прямо вербализовано: «Денег нет».",
        "income_sources": [
          "Социальная помощь (статус S в Швейцарии).",
          "Еженедельная бесплатная раздача еды.",
          "Случайные находки (зафиксирован случай нахождения 50 CHF в банкомате)."
        ],
        "liabilities": [
          {
            "creditor": "Борис",
            "amount": "1100 долларов."
          },
          {
            "creditor": "Шикал",
            "amount": "500 долларов (с учетом процентов оценивается в ~1000 долларов)."
          }
        ],
        "impact": "Отсутствие денег напрямую саботирует S1 (Тело/Энергия) из-за невозможности поддерживать диету с высоким содержанием белка."
      },
      "monetization_strategy": {
        "primary_strategy_ai_comics": {
          "platforms": "Gumroad, Ko-fi, Patreon, Kickstarter.",
          "product": "Пилотный выпуск «Одинотарис» / «Нуар-Терапия» (15-20 иллюстраций, интерактивный PDF, аудио).",
          "price_point": "Стартовая цена 3-3.99 CHF/$, цена за сезон (10 эп.) $12.99-14.99.",
          "marketing_funnel": "YouTube shorts / TikTok как воронка продаж."
        },
        "secondary_strategy_freelance": {
          "platforms": "Fiverr, Upwork (после снятия психологического блока).",
          "services": [
            "Создание AI-иллюстраций в стиле нуар.",
            "Монтаж коротких видео для TikTok/Shorts.",
            "Дизайн-услуги."
          ]
        },
        "tertiary_strategy_b2b_agents": {
          "concept": "Создание и продажа персонализированных микроприложений (AI-агентов, чат-ботов) для локального бизнеса (стоматологии, «Айсмен»).",
          "price_point": "200-1000 CHF."
        }
      },
      "material_assets_and_tools": {
        "production_hardware": [
          "Основной компьютер (с 'взломанной Windows').",
          "Сломанный ноутбук.",
          "Гантели.",
          "Инфракрасная лампа."
        ],
        "digital_subscriptions_and_tools": [
          "SORA/Midjourney, ChatGPT/Gemini Pro, Cursor.",
          "iHerb (для заказа БАДов)."
        ]
      },
      "administrative_and_financial_backlog": {
        "status": "Критический. Несколько просроченных административных задач ('хвостов') потребляют пассивный ментальный ресурс.",
        "tasks": [
          "Serafe: Необходимо оформить и отправить письмо на немецком.",
          "BITZ: Необходимо обновить и отправить CV (дедлайн просрочен).",
          "BlueColumn: Необходимо заполнить формуляр.",
          "Gemida: Необходимо предоставить подтверждения."
        ]
      }
    },
    "synergy": {
      "produces_for": {
        "S3_HABITAT": "Обеспечивает бюджет на покупку и апгрейд оборудования, инструментов и улучшение физической среды.",
        "S6_CRAFT_PRODUCTION": "Предоставляет ресурсы для доступа к платным pro-инструментам, что увеличивает мощность производства.",
        "S5_COMMUNICATION_INFLUENCE": "Дает бюджет на промоушн, съемку и другие активности по усилению бренда."
      },
      "consumes_from": {
        "S6_CRAFT_PRODUCTION": "Требует произведенной ценности (продуктов, услуг), которую можно продавать и конвертировать в капитал.",
        "S5_COMMUNICATION_INFLUENCE": "Нуждается в эффективной коммуникации и продажах для конвертации влияния в денежный поток."
      }
    }
  }
}

async function importSphereDetails() {
  console.log('🚀 ИМПОРТ ДЕТАЛЬНОЙ ИНФОРМАЦИИ О СФЕРАХ')
  console.log('=========================================')
  
  try {
    // Получаем список пользователей и их сфер
    const { data: spheres, error: fetchError } = await supabase
      .from('life_spheres')
      .select('id, user_id, sphere_code, sphere_name')
      .not('sphere_code', 'is', null)
      
    if (fetchError) {
      console.error('❌ Ошибка получения списка сфер:', fetchError)
      return
    }
    
    if (!spheres || spheres.length === 0) {
      console.log('⚠️ Сферы с sphere_code не найдены. Сначала выполните seed.')
      return
    }
    
    console.log(`📊 Найдено ${spheres.length} сфер для обновления`)
    
    let updated = 0
    let errors = 0
    
    for (const sphere of spheres) {
      const { sphere_code, id, sphere_name } = sphere
      
      if (!sphereDetails[sphere_code]) {
        console.log(`⚠️ Детали для сферы ${sphere_code} не найдены, пропускаем`)
        continue
      }
      
      const details = sphereDetails[sphere_code]
      
      const { error: updateError } = await supabase
        .from('life_spheres')
        .update({ 
          sphere_details: details,
          sphere_name: details.meta.title // Обновляем название на полное
        })
        .eq('id', id)
        
      if (updateError) {
        console.error(`❌ Ошибка обновления сферы ${sphere_code} (${id}):`, updateError)
        errors++
      } else {
        console.log(`✅ Обновлена сфера ${sphere_code}: ${details.meta.title}`)
        updated++
      }
    }
    
    console.log('\n📈 РЕЗУЛЬТАТЫ ИМПОРТА:')
    console.log(`✅ Обновлено: ${updated} сфер`)
    console.log(`❌ Ошибок: ${errors}`)
    console.log(`📊 Всего обработано: ${spheres.length} сфер`)
    
    if (updated > 0) {
      console.log('\n🎉 ИМПОРТ ЗАВЕРШЕН УСПЕШНО!')
      console.log('Теперь на платформе будет видна вся детальная информация о сферах')
    }
    
  } catch (error) {
    console.error('💥 Критическая ошибка при импорте:', error)
  }
}

// Запускаем импорт
importSphereDetails()
